!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("dwv")):"function"==typeof define&&define.amd?define(["dwv"],t):"object"==typeof exports?exports.dwvsimplistic=t(require("dwv")):e.dwvsimplistic=t(e.dwv)}(this,(e=>(()=>{"use strict";var t={440:t=>{t.exports=e}},n={};function o(e){var r=n[e];if(void 0!==r)return r.exports;var i=n[e]={exports:{}};return t[e](i,i.exports,o),i.exports}o.d=(e,t)=>{for(var n in t)o.o(t,n)&&!o.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},o.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),o.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var r={};function i(e){return i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i(e)}function a(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,l(o.key),o)}}function l(e){var t=function(e){if("object"!=i(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=i(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==i(t)?t:t+""}function s(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function d(e,t){return e.get(u(e,t))}function c(e,t,n){return e.set(u(e,t),n),n}function u(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}o.r(r),o.d(r,{startApp:()=>R}),o(440);var v={Scroll:"M110-215v-118h740v118H110Zm0-206v-118h740v118H110Zm0-206v-118h740v118H110Z",ZoomAndPan:"M763-106 517-352q-29 18-64.292 28.5T376.035-313Q267-313 190-390t-77-186q0-109 77-186t186-77q109 0 186 77t77 186.035q0 42.381-10.5 76.673T600-437l247 248-84 83ZM376-431q61 0 103-42t42-103q0-61-42-103t-103-42q-61 0-103 42t-42 103q0 61 42 103t103 42Z",WindowLevel:"M480.192-62Q394-62 318-94.5q-76-32.5-133.5-90t-90-133.542Q62-394.083 62-480.542 62-567 94.5-642.5t90-133q57.5-57.5 133.542-90 76.041-32.5 162.5-32.5Q567-898 642.5-865.5t133 90q57.5 57.5 90 133.308 32.5 75.807 32.5 162Q898-394 865.5-318q-32.5 76-90 133.5t-133.308 90q-75.807 32.5-162 32.5ZM528-184q109-18 180.5-99.222T780-480q0-112.818-71.5-194.909T528-775v591Z",Draw:"M183-215q-49.7 0-83.85-34.15Q65-283.3 65-333v-294q0-49.7 34.15-83.85Q133.3-745 183-745h594q49.7 0 83.85 34.15Q895-676.7 895-627v294q0 49.7-34.15 83.85Q826.7-215 777-215H183Zm0-118h594v-294H672v147h-72v-147h-84v147h-72v-147h-84v147h-72v-147H183v294Zm105-147h72-72Zm156 0h72-72Zm156 0h72-72Zm-120 0Z",Reset:"M476-158q-133 0-227.5-94.5T154-480q0-133 94.5-227.5T476-802q74 0 136 30t106 82v-112h88v289H516v-87h125q-29-38-71.5-61T476-684q-85 0-144.5 59.5T272-480q0 85 59.5 144.5T476-276q78 0 134.5-52.5T677-456h121q-10 126-102 212t-220 86Z",ToggleOrientation:"M327-273q-35.888 0-61.444-25.556Q240-324.112 240-360v-209q0-36.3 25.15-62.15T327-657h33l48-48h144l48 48h33q36.7 0 61.85 25.85T720-569v209q0 35.888-25.556 61.444Q668.888-273 633-273H327Zm0-87h306v-209H327v209Zm153.425-40Q507-400 525.5-419.133q18.5-19.132 18.5-46Q544-492 525.075-510.5q-18.925-18.5-45.5-18.5T434.5-510.075q-18.5 18.925-18.5 45.5T434.925-419q18.925 19 45.5 19ZM336-937q35.783-11.9 73.033-17.45Q446.283-960 485-960q91 0 173.5 33.5T805-835.275q64 57.725 104.544 136.5Q950.089-620 960-528H857q-8-61-34.5-115.5t-67-97q-40.5-42.5-94-71T547-851l46 47-60 62-197-195ZM624-23q-35.783 11.9-73.033 17.45Q513.717 0 475 0q-91.92 0-174.46-33.5t-146.04-91Q91-182 49.956-261 8.91-340 0-432h103q7 61 33.5 115.5t67.5 97q41 42.5 94.5 71T413-109l-46-47 60-62L624-23ZM482-466Z",Fullscreen:"M110-110v-334h118v132l420-420H516v-118h334v334H732v-132L312-228h132v118H110Z",Tags:"M406-405h177v-92H406v92Zm0-132h354v-92H406v92Zm0-132h354v-92H406v92Zm-51 440q-53 0-89.5-36.5T229-355v-456q0-53 36.5-89.5T355-937h456q53 0 89.5 36.5T937-811v456q0 53-36.5 89.5T811-229H355Zm0-126h456v-456H355v456ZM149-23q-53 0-89.5-36.5T23-149v-582h126v582h582v126H149Zm206-788v456-456Z"};function h(e,t){var n="http://www.w3.org/2000/svg",o=document.createElementNS(n,"path");o.setAttributeNS(null,"d",v[e]);var r=document.createElementNS(n,"svg");r.setAttributeNS(null,"height",20),r.setAttributeNS(null,"width",20),r.setAttributeNS(null,"viewBox","0 -960 960 960"),r.appendChild(o);var i=document.createElement("button");return i.id=t.getToolId(e),i.title=e,i.appendChild(r),"Reset"===e?i.addEventListener("click",(function(){t.onDisplayReset()})):"ToggleOrientation"===e?i.addEventListener("click",(function(){t.toggleOrientation()})):"Fullscreen"===e?i.addEventListener("click",(function(){t.toggleFullScreen()})):"Tags"===e?i.addEventListener("click",(function(){t.openTagsModal()})):i.addEventListener("click",(function(){t.onChangeTool(e)})),i}function p(e,t){var n=document.createElement("option");n.value="",n.appendChild(document.createTextNode("Preset..."));var o=document.createElement("select");return o.id=t.getToolId(e),o.title="Window level presets",o.appendChild(n),o.addEventListener("change",(function(){t.onChangePreset(this.value)})),o}var m=new WeakMap,f=new WeakMap,g=new WeakMap,y=new WeakMap,w=new WeakMap,b=function(){return e=function e(t,n,o){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),s(this,m,void 0),s(this,f,void 0),s(this,g,void 0),s(this,y,void 0),s(this,w,void 0),c(g,this,t),c(y,this,n),c(w,this,o)},(t=[{key:"init",value:function(){for(var e=document.getElementById(this.getToolbarDivId()),t=0;t<d(y,this).length;++t)"WindowLevelPresets"===d(y,this)[t]?e.appendChild(p(d(y,this)[t],this)):e.appendChild(h(d(y,this)[t],this))}},{key:"showProgressBar",value:function(){var e=document.createElement("progress");e.id="progress-"+d(w,this),e.max="100",e.value="0",document.getElementById(this.getToolbarDivId()).appendChild(e)}},{key:"setProgress",value:function(e){var t=document.getElementById("progress-"+d(w,this));t&&(100===e?t.remove():t.value=e)}},{key:"getDwvDivId",value:function(){return"dwv-"+d(w,this)}},{key:"getLayerGroupDivId",value:function(){return"layerGroup-"+d(w,this)}},{key:"getToolbarDivId",value:function(){return"toolbar-"+d(w,this)}},{key:"getToolId",value:function(e){return e.toLowerCase()+"-"+d(w,this)}},{key:"enableTool",value:function(e,t){var n=this.getToolId(e);document.getElementById(n).disabled=!t}},{key:"enableTools",value:function(e){for(var t=0;t<d(y,this).length;++t)this.enableTool(d(y,this)[t],e)}},{key:"activateTool",value:function(e,t){var n=this.getToolId(e);t?document.getElementById(n).classList.add("active"):document.getElementById(n).classList.remove("active")}},{key:"activateTools",value:function(e){for(var t=0;t<d(y,this).length;++t)this.activateTool(d(y,this)[t],e)}},{key:"onChangePreset",value:function(e){d(g,this).setWindowLevelPreset(e),this.setSelectedPreset(e)}},{key:"onChangeTool",value:function(e){this.activateTools(!1),this.activateTool(e,!0),d(g,this).setTool(e),"Draw"===e&&d(g,this).setToolFeatures({shapeName:"Ruler"})}},{key:"onDisplayReset",value:function(){d(g,this).resetDisplay();var e=this.getToolId("WindowLevelPresets");document.getElementById(e).selectedIndex=0}},{key:"toggleOrientation",value:function(){void 0!==d(m,this)?"axial"===d(m,this)?c(m,this,"coronal"):"coronal"===d(m,this)?c(m,this,"sagittal"):"sagittal"===d(m,this)&&c(m,this,"axial"):c(m,this,"coronal");var e={"*":[{divId:this.getLayerGroupDivId(),orientation:d(m,this)}]};d(g,this).setDataViewConfigs(e);for(var t=d(g,this).getDataIds(),n=0;n<t.length;++n)d(g,this).render(t[n])}},{key:"toggleFullScreen",value:function(){var e=this,t=this.getLayerGroupDivId(),n=document.getElementById(t);if(document.fullscreenElement)document.exitFullscreen&&(document.exitFullscreen(),n.style.height=d(f,this));else{var o=this.getDwvDivId();document.getElementById(o).requestFullscreen().then((function(){c(f,e,n.style.height),n.style.height="100%"}))}}},{key:"openTagsModal",value:function(){var e=document.createElement("div");e.className="modal",e.id="modal-"+d(w,this),e.style.display="block",window.addEventListener("click",(function(t){t.target===e&&(e.style.display="none")}));var t=document.createElement("div");t.className="modal-content",t.id="modal-content-"+d(w,this),e.appendChild(t);var n=document.createElement("h2");n.appendChild(document.createTextNode("DICOM Tags")),t.appendChild(n);var o=document.createElement("div");o.className="modal-content-scroll";var r,i=d(g,this).getMetaData("0"),a=i["00200013"];if(void 0!==a){var l=a.value;"string"==typeof l&&(l=[l]),(r=l.map(Number)).sort((function(e,t){return e-t}))}var s=r[0],c=document.createElement("input");c.type="range",c.id="instancenumber-slider-"+d(w,this),c.min=0,c.max=r.length-1,c.value=0,c.title="Instance Number";var u=document.createElement("label");u.id="instancenumber-slider-label-"+d(w,this),u.for=c.id,u.appendChild(document.createTextNode(s)),u.title=c.title;var v=document.createElement("p");v.appendChild(c),v.appendChild(u),t.appendChild(v),c.addEventListener("input",(function(e){s=r[e.target.value];var t=T(E(i,s));o.replaceChildren(t),u.replaceChildren(document.createTextNode(s))}));var h=T(E(i,s));o.appendChild(h),t.appendChild(o),document.getElementById(this.getDwvDivId()).appendChild(e)}},{key:"updatePresets",value:function(e){for(var t=this.getToolId("WindowLevelPresets"),n=document.getElementById(t);n.hasChildNodes();)n.removeChild(n.firstChild);for(var o=0;o<e.length;++o){var r=document.createElement("option");r.value=e[o];var i=e[o];r.appendChild(document.createTextNode(i)),n.appendChild(r)}}},{key:"setSelectedPreset",value:function(e){var t=this.getToolId("WindowLevelPresets"),n=document.getElementById(t),o=0;for(o in n.options)if(n.options[o].value===e)break;n.selectedIndex=o}}])&&a(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function T(e){var t,n,o=document.createElement("table");if(void 0===e||0===e.length)return t=o.insertRow(-1),(n=document.createElement("td")).appendChild(document.createTextNode("Empty input array...")),t.appendChild(n),o;for(var r=e[0],i=Object.keys(r),a=0;a<e.length;++a){t=o.insertRow(-1);for(var l=0;l<i.length;++l)(n=document.createElement("td")).appendChild(document.createTextNode(e[a][i[l]])),t.appendChild(n)}for(var s=o.createTHead().insertRow(-1),d=0;d<i.length;++d){var c=document.createElement("th"),u=i[d];u=u.charAt(0).toUpperCase()+u.slice(1),c.appendChild(document.createTextNode(u)),s.appendChild(c)}return o}function E(e,t){var n,o;return function(e){return void 0!==e["00020010"]}(e)?n=L(e,t,""):(o=e,n=function(e,t){return e.push({name:t,value:o[t].value}),e}),Object.keys(e).reduce(n,[])}function L(e,t,n){return function(o,r){var i=dwv.getTagFromKey(r),a=i.getNameFromDictionary();void 0===a&&(a="x"+i.getKey());var l=a,s=e[r],d=s.value;if(void 0===d.slice&&void 0!==d[t]&&(d=d[t]),"InstanceNumber"===l&&(d=t),"SQ"===s.vr){o.push({name:(n?n+" ":"")+l,value:""});for(var c=0;c<d.length;++c){var u=d[c],v=Object.keys(u).reduce(L(u,t,n+"["+c+"]"),[]);o=o.concat(v)}}else"O"===s.vr[0]&&d.length>10&&(d=d.slice(0,10).toString()+"... (len:"+d.length+")"),o.push({name:(n?n+" ":"")+l,value:d.toString()});return o}}function k(e){return k="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},k(e)}function C(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,q(o.key),o)}}function q(e){var t=function(e){if("object"!=k(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=k(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==k(t)?t:t+""}function P(e,t,n){(function(e,t){if(t.has(e))throw new TypeError("Cannot initialize the same private elements twice on an object")})(e,t),t.set(e,n)}function I(e,t){return e.get(S(e,t))}function x(e,t,n){return e.set(S(e,t),n),n}function S(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw new TypeError("Private element is not present on this object")}var M=new WeakMap,N=new WeakMap,W=new WeakMap,Z=new WeakMap,D=new WeakMap,O=new WeakMap,j=new WeakMap,B=new WeakMap,H=new WeakMap,A=new WeakMap,Q=new WeakMap,F=function(){return e=function e(t,n){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),P(this,M,void 0),P(this,N,void 0),P(this,W,"dropBox"),P(this,Z,"dropBox"),P(this,D,"dropBoxBorder"),P(this,O,"hover"),P(this,j,(function(e){e.stopPropagation(),e.preventDefault()})),P(this,B,(function(e){I(j,o).call(o,e);var t=document.getElementById(I(W,o));t&&-1===t.className.indexOf(I(O,o))&&(t.className+=" "+I(O,o))})),P(this,H,(function(e){I(j,o).call(o,e);var t=document.getElementById(I(W,o));t&&-1!==t.className.indexOf(I(O,o))&&(t.className=t.className.replace(" "+I(O,o),""))})),P(this,A,(function(e){I(j,o).call(o,e),I(M,o).loadFiles(e.dataTransfer.files)})),P(this,Q,(function(e){e.target&&e.target.files&&I(M,o).loadFiles(e.target.files)})),x(M,this,t),x(N,this,n)},(t=[{key:"init",value:function(){this.showDropbox(!0)}},{key:"showDropbox",value:function(e){var t=document.getElementById(I(W,this));if(t){var n=document.getElementById("layerGroup-"+I(N,this));if(e){if(t.className=I(Z,this)+" "+I(D,this),""===t.innerHTML){var o=document.createElement("p");o.appendChild(document.createTextNode("Drag and drop data here or "));var r=document.createElement("input");r.onchange=I(Q,this),r.type="file",r.multiple=!0,r.id="input-file",r.style.display="none";var i=document.createElement("label");i.htmlFor="input-file";var a=document.createElement("a");a.appendChild(document.createTextNode("click here")),a.id="input-file-link",i.appendChild(a),o.appendChild(r),o.appendChild(i),t.appendChild(o)}t.setAttribute("style","display:initial"),n&&(n.removeEventListener("dragover",I(j,this)),n.removeEventListener("dragleave",I(j,this)),n.removeEventListener("drop",I(A,this))),t.addEventListener("dragover",I(B,this)),t.addEventListener("dragleave",I(H,this)),t.addEventListener("drop",I(A,this))}else t.className=I(Z,this),t.innerHTML="",t.setAttribute("style","display:none"),t.removeEventListener("dragover",I(B,this)),t.removeEventListener("dragleave",I(H,this)),t.removeEventListener("drop",I(A,this)),n&&(n.addEventListener("dragover",I(j,this)),n.addEventListener("dragleave",I(j,this)),n.addEventListener("drop",I(A,this)))}}}])&&C(e.prototype,t),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t}();function R(e,t){var n={dataViewConfigs:{"*":[{divId:"layerGroup-"+e}]},tools:{Scroll:{},ZoomAndPan:{},WindowLevel:{},Draw:{options:["Ruler"]}}},o=new dwv.App;o.init(n);var r=Object.keys(n.tools),i=r.indexOf("WindowLevel");-1!==i&&r.splice(i+1,0,"WindowLevelPresets"),r.push("Reset"),r.push("ToggleOrientation"),r.push("Fullscreen"),r.push("Tags");var a=new b(o,r,e);a.init(),a.enableTools(!1);var l=function(e){e.ctrlKey&&88===e.keyCode&&(console.log("Abort load received from user (crtl-x)."),o.abortLoad())},s=null,d=null,c=null,u=null;o.addEventListener("loadstart",(function(){s=0,d=0,c=0,u=!0,window.addEventListener("keydown",l),a.showProgressBar()})),o.addEventListener("loadprogress",(function(e){var t=Math.ceil(100*e.loaded/e.total);a.setProgress(t)})),o.addEventListener("load",(function(){a.setProgress(100)})),o.addEventListener("loaditem",(function(){++s})),o.addEventListener("renderend",(function(){if(u){u=!1,a.enableTools(!0);var e="ZoomAndPan";o.canScroll()?e="Scroll":a.enableTool("Scroll",!1),o.canWindowLevel()||a.enableTool("WindowLevel",!1),o.setTool(e),a.activateTool(e,!0);var n=o.getActiveLayerGroup().getActiveViewLayer().getViewController(),r=!1;if(void 0!==t&&void 0!==t.wlpreset){r=!0;var i=t.wlpreset,l={};l[i.name]={wl:[new dwv.WindowCenterAndWidth(i.center,i.width)],name:i.name},n.addWindowLevelPresets(l)}a.updatePresets(n.getWindowLevelPresetsNames()),r&&(n.setWindowLevelPreset(i.name),a.setSelectedPreset(t.wlpreset.name))}})),o.addEventListener("error",(function(e){console.error(e.error),++d})),o.addEventListener("abort",(function(){++c})),o.addEventListener("loadend",(function(){if(d){var e="A load error has ";d>1&&(e=d+" load errors have "),e+="occured. See log for details.",alert(e)}0!==c&&console.warn("Data load was aborted."),window.removeEventListener("keydown",l)}));var v=new F(o,e);v.init(),o.addEventListener("loadstart",(function(){v.showDropbox(!1)})),o.addEventListener("loadend",(function(){s&&0===c||v.showDropbox(!0)})),o.addEventListener("keydown",(function(e){o.defaultOnKeydown(e)})),window.addEventListener("resize",o.onResize),o.addEventListener("wlchange",(function(){var e=o.getActiveLayerGroup().getActiveViewLayer().getViewController();a.updatePresets(e.getWindowLevelPresetsNames()),a.setSelectedPreset("manual")})),void 0!==t&&void 0!==t.urls?o.loadURLs(t.urls):o.loadFromUri(window.location.href)}return r})()));
//# sourceMappingURL=dwvsimplistic.min.js.map